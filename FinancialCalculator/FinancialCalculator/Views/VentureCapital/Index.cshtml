@{
    ViewBag.Title = "Venture Capital Formula";
}

<script type="text/javascript" src="~/Scripts/site/forms.js"></script>
<script type="text/javascript">
    var round_index = 1;

    function validateFields() {
        var YearExitGood = $.isNumeric($('#years-to-exit').val());
        var PeRatioGood = $.isNumeric($('#pe-ratio').val());
        var ExitEarningsGood = $.isNumeric($('#earnings-at-exit').val());
        var YearsAreGood = true;
        $('.years-from-start').each(function (index) {
            YearsAreGood = YearsAreGood && ($.isNumeric($(this).val()));
        });
        var FundsAreGood = true;
        $('.invested-funds').each(function (index) {
            FundsAreGood = FundsAreGood && ($.isNumeric($(this).val()));
        });
        var RoiAreGood = true;
        $('.required-roi').each(function (index) {
            RoiAreGood = RoiAreGood && ($.isNumeric($(this).val()));
        });
        if (!YearExitGood) {
            $.Notify({
                caption: 'Error',
                content: 'Must input number for Years to Exit.',
            });
        }
        if (!PeRatioGood) {
            $.Notify({
                caption: 'Error',
                content: 'Must input number for P/E Ratio.',
            });
        }
        if (!ExitEarningsGood) {
            $.Notify({
                caption: 'Error',
                content: 'Must input a number for Earnings at Exit',
            });
        }
        if (!YearsAreGood) {
            $.Notify({
                caption: 'Error',
                content: 'Input a number for all years.',
            });
        }
        if (!FundsAreGood) {
            $.Notify({
                caption: 'Error',
                content: 'Input a number for all invested funds.',
            });
        }
        if (!RoiAreGood) {
            $.Notify({
                caption: 'Error',
                content: 'Input a number for all required ROIs.',
            });
        }
        return (YearExitGood && PeRatioGood && ExitEarningsGood && YearsAreGood && FundsAreGood && RoiAreGood)
    }

    function submitVc() {
        /*
        var cashFlows = new Array();
        var P, y;
        var m, M, N;
        var repeat, repeatCount;

        // Grab our cash flows
        $('.CF').each(function () {
            var id = $(this).attr('id');
            // CF_###
            var num = parseInt(id.split('_')[1]);
            cashFlows[num] = parseField($(this).val());
        });

        // P or y?
        var useP = true;
        if ($('#P').attr('disabled'))
            useP = false;

        // Mm or N?
        var useMm = true;
        if ($('#M').attr('disabled'))
            useMm = false;

        // Get P or y
        if (useP)
            P = parseField($('#P').val());
        else
            y = parseField($('#y').val());

        if (useMm) {
            M = parseField($('#M').val());
            m = parseField($('#m').val());
        } else
            N = parseField($('#N').val());

        repeat = $('#repeat').is(':checked');
        if (repeat)
            repeatCount = parseField($('#repeatCount').val());
        else
            repeatCount = 0;
        
        var func = getFunctionName(useP, useMm, repeat, repeatCount);

        var params = new Object();
        params.cashFlows = cashFlows;
        if (useP)
            params.P = P;
        else
            params.y = y;
        if (useMm) {
            params.M = M;
            params.littleM = m;
        } else
            params.N = N;
        params.repeat = repeat;
        params.repeatCount = repeatCount;
        var serialized = $.param(params, true);
        var url = func + '?' + serialized;
        window.location.href = url;
        */
    }

    $(function () {
        $('#addRound').click(function () {
            round_index++;
            $('.round-row').last().after(
            '<div id="round_' + round_index + '" class="row round-row">' +
            '<div class="input-control text span2">' +
            '<input class="years-from-start" type="text" placeholder="Year" />' +
            '</div>' +
            '<div class="input-control text span5">' +
            '<input class="invested-funds" type="text" placeholder="Invested Funds" />' +
            '</div>' +
            '<div class="input-control text span5">' +
            '<input class="required-roi" type="text" placeholder="Required ROI" />' +
            '</div>' +
            '</div>');
        });

        $('#submit-vc').click(function () {
            if (validateFields())
                submitVc();
        });
    });
</script>

<div class="row">
    <div class="span12">
        <h1>@(ViewBag.Title)</h1>
    </div>
</div>
<div class="row">
    <div class="span12">
        <div class="row">
            <div class="span12">
                <h2>Enter years to exit, P/E ratio, and earnings at exit</h2>
            </div>
        </div>
        <div class="row">
            <div class="input-control text span4">
                <label>Years to Exit</label>
                <input id="years-to-exit" type="text" />
            </div>
            <div class="input-control text span4">
                <label>P/E Ratio</label>
                <input id="pe-ratio" type="text" />
            </div>
            <div class="input-control text span4">
                <label>Earnings at Exit</label>
                <input id="earnings-at-exit" type="text" />
            </div>
        </div>
        <div class="row">
            <div class="span12">
                <hr />
                <h2>Input invested funds and required ROI for each round</h2>
            </div>
        </div>
        <div id="round_1" class="row round-row">
            <div class="input-control text span2">
                <input class="years-from-start" type="text" placeholder="Year" />
            </div>
            <div class="input-control text span5">
                <input class="invested-funds" type="text" placeholder="Invested Funds" />
            </div>
            <div class="input-control text span5">
                <input class="required-roi" type="text" placeholder="Required ROI" />
            </div>
        </div>
        <div class="row">
            <div class="span4">
                <button id="addRound" class="large success">Add Round</button>
            </div>
        </div>
        <div class="row"></div>
        <div class="row">
            <div class="span12">
                <button id="submit-vc" class="large primary">Submit</button>
            </div>
        </div>
    </div>
</div>
